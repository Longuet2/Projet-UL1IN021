<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Historique des Parties - Pong</title>
  <link rel="stylesheet" href="{{ url_for('static', path='css/style_historique.css') }}">
</head>
<body>
  <div class="container">
    <h1>üìä Historique des Parties</h1>
    
    <div class="stats-summary" id="statsSummary">
      <div class="stat-card">
        <h3>Total de parties</h3>
        <p id="totalGames">0</p>
      </div>
    </div>

    <div class="games-table-container">
      <table class="games-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Joueur 1</th>
            <th>Score</th>
            <th>VS</th>
            <th>Score</th>
            <th>Joueur 2</th>
            <th>Gagnant</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="gamesTableBody">
          <tr>
            <td colspan="8" class="loading">Chargement...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="back-button-container">
      <button onclick="window.location.href='/'" class="back-button">
        ‚Üê Retour √† l'accueil
      </button>
    </div>
  </div>

  <script>
    // Charger l'historique au chargement de la page
    async function loadHistory() {
      try {
        const response = await fetch('/api/games');
        const games = await response.json();
        
        const tbody = document.getElementById('gamesTableBody');
        const totalGamesElement = document.getElementById('totalGames');
        
        // Mettre √† jour le total
        totalGamesElement.textContent = games.length;
        
        if (games.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" class="no-games">Aucune partie jou√©e pour le moment</td></tr>';
          return;
        }
        
        // Cr√©er les lignes du tableau
        tbody.innerHTML = games.map((game, index) => {
          const date = new Date(game.timestamp);
          const formattedDate = date.toLocaleString('fr-FR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          // D√©terminer le style du gagnant
          const player1Class = game.winner === game.player1_name ? 'winner' : '';
          const player2Class = game.winner === game.player2_name ? 'winner' : '';
          
          return `
            <tr>
              <td>${games.length - index}</td>
              <td class="${player1Class}">${game.player1_name}</td>
              <td class="score ${player1Class}">${game.player1_score}</td>
              <td class="vs">VS</td>
              <td class="score ${player2Class}">${game.player2_score}</td>
              <td class="${player2Class}">${game.player2_name}</td>
              <td class="winner-cell">üèÜ ${game.winner}</td>
              <td class="date">${formattedDate}</td>
            </tr>
          `;
        }).join('');
        
      } catch (error) {
        console.error('Erreur lors du chargement de l\'historique:', error);
        document.getElementById('gamesTableBody').innerHTML = 
          '<tr><td colspan="8" class="error">Erreur lors du chargement</td></tr>';
      }
    }
    
    // Charger au d√©marrage
    loadHistory();
    
    // Recharger toutes les 10 secondes
    setInterval(loadHistory, 10000);
  </script>
</body>
</html>
