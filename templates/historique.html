<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- Encodage des caractères -->
  <meta charset="utf-8">

  <!-- Titre de la page -->
  <title>Historique des Parties - Pong</title>

  <!-- Feuille de style dédiée à l'historique -->
  <link rel="stylesheet" href="{{ url_for('static', path='css/style_historique.css') }}">
</head>
<body>
  <!-- Conteneur principal de la page -->
  <div class="container">
    <h1>Historique des Parties</h1>
    
    <!-- Résumé des statistiques -->
    <div class="stats-summary" id="statsSummary">
      <div class="stat-card">
        <h3>Total de parties</h3>
        <p id="totalGames">0</p>
      </div>
    </div>

    <!-- Tableau affichant l’historique des parties -->
    <div class="games-table-container">
      <table class="games-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Joueur 1</th>
            <th>Score</th>
            <th>VS</th>
            <th>Score</th>
            <th>Joueur 2</th>
            <th>Gagnant</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="gamesTableBody">
          <!-- Contenu remplacé dynamiquement par JavaScript -->
          <tr>
            <td colspan="8" class="loading">Chargement...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Bouton de retour à la page d'accueil -->
    <div class="back-button-container">
      <button onclick="window.location.href='/'" class="back-button">
        ← Retour à l'accueil
      </button>
    </div>
  </div>

  <script>
    // Charge l’historique des parties depuis l’API
    async function loadHistory() {
      try {
        const response = await fetch('/api/games');
        const games = await response.json();
        
        const tbody = document.getElementById('gamesTableBody');
        const totalGamesElement = document.getElementById('totalGames');
        
        // Mise à jour du nombre total de parties
        totalGamesElement.textContent = games.length;
        
        // Cas où aucune partie n’est enregistrée
        if (games.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="8" class="no-games">Aucune partie jouée pour le moment</td></tr>';
          return;
        }
        
        // Génération dynamique des lignes du tableau
        tbody.innerHTML = games.map((game, index) => {
          const date = new Date(game.timestamp);
          const formattedDate = date.toLocaleString('fr-FR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          // Mise en évidence du joueur gagnant
          const player1Class = game.winner === game.player1_name ? 'winner' : '';
          const player2Class = game.winner === game.player2_name ? 'winner' : '';
          
          return `
            <tr>
              <td>${games.length - index}</td>
              <td class="${player1Class}">${game.player1_name}</td>
              <td class="score ${player1Class}">${game.player1_score}</td>
              <td class="vs">VS</td>
              <td class="score ${player2Class}">${game.player2_score}</td>
              <td class="${player2Class}">${game.player2_name}</td>
              <td class="winner-cell">${game.winner}</td>
              <td class="date">${formattedDate}</td>
            </tr>
          `;
        }).join('');
        
      } catch (error) {
        console.error(
          'Erreur lors du chargement de l\'historique:',
          error
        );

        // Message affiché en cas d’erreur de chargement
        document.getElementById('gamesTableBody').innerHTML =
          '<tr><td colspan="8" class="error">Erreur lors du chargement</td></tr>';
      }
    }
    
    // Chargement initial au démarrage de la page
    loadHistory();
    
    // Rafraîchissement automatique toutes les 10 secondes
    setInterval(loadHistory, 10000);
  </script>
</body>
</html>

